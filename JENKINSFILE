pipeline {
  agent any

  stages {
    stage('Get Code') {
      steps {
        checkout([
          $class: 'GitSCM',
          branches: [[name: '*/develop']],
          userRemoteConfigs: [[
            url: 'git@github.com:PabloBin/todo-list-aws.git',
            credentialsId: 'github-deploykey'
          ]]
        ])
        sh 'echo "Branch:" && git branch -a --contains HEAD'
        sh 'echo "Last commit:" && git log -1 --oneline'
      }
    }

    stage('Static - Flake8') {
      steps {
        sh '''
          set -eux
          sudo apt-get update
          sudo apt-get install -y python3-venv
        
          python3 -m venv .venv
          . .venv/bin/activate
          pip install -U pip flake8
          flake8 --version
        '''
      }
    }
  }
}
